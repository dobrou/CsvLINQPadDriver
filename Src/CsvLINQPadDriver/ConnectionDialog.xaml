<Window x:Class="CsvLINQPadDriver.ConnectionDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="CSV Files Connection"
    Icon="Connection.ico"
    Width="640"
    Height="520"
    WindowStartupLocation="CenterScreen"
    FocusManager.FocusedElement="{Binding ElementName=FilesTextBox}"
    Loaded="ConnectionDialog_OnLoaded">

    <Window.CommandBindings>
        <CommandBinding
            Command="ApplicationCommands.Paste"
            Executed="PasteAndGoCommandBinding_OnExecuted"
            CanExecute="PasteAndGoCommandBinding_OnCanExecute"/>
    </Window.CommandBindings>
    <Window.InputBindings>
        <KeyBinding
            Command="ApplicationCommands.Paste"
            Gesture="Ctrl+Shift+V"/>
    </Window.InputBindings>

    <Grid Margin="7">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0">
            <Label Padding="0,0,0,3" Focusable="False" Content="CSV files. Drag&amp;drop (use Ctrl to add files) or type one file/directory per line" DockPanel.Dock="Top" />
            <TextBox
            Name="FilesTextBox"
            AcceptsReturn="True" 
            HorizontalScrollBarVisibility="Auto"
            VerticalScrollBarVisibility="Auto"
            Text="{Binding Files, UpdateSourceTrigger=PropertyChanged}" 
            ToolTip="CSV files. Drag&amp;drop (use Ctrl to add files) or type one file per line. Supports mask '*.csv' or recursive '**.csv'"
            AllowDrop="True"
            PreviewDragEnter="FilesTextBox_DragEnter"
            PreviewDragOver="FilesTextBox_DragEnter"
            PreviewDrop="FilesTextBox_DragDrop"
            />
        </DockPanel>

        <StackPanel Grid.Row="1">
            <GroupBox Header="File format">
            <StackPanel Margin="2" Height="Auto">
                <DockPanel>
                    <Label Padding="0,0,0,3" Content="CSV separator (autodetect if empty) "/>
                    <TextBox MaxLength="6" MaxLines="1" Text="{Binding CsvSeparator}" ToolTip="Character used to separate columns in CSV file. If empty, separator is auto-detected for each file"/>
                </DockPanel>
                <CheckBox IsChecked="{Binding IgnoreInvalidFiles}" ToolTip="Ignore files with invalid format">Ignore files with invalid format</CheckBox>
            </StackPanel>
            </GroupBox>

            <GroupBox Header="Memory">
                <StackPanel Margin="2" Height="Auto">
                    <CheckBox IsChecked="{Binding IsCacheEnabled}" ToolTip="Cache parsed rows. This cache survives multiple query runs, even when query is changed">Cache CSV data in memory</CheckBox>
                    <CheckBox IsChecked="{Binding IsStringInternEnabled}" ToolTip="Intern strings. Significantly reduce memory consumption when CSV contains repeatable values">Intern CSV strings</CheckBox>
                </StackPanel>
            </GroupBox>
            <CheckBox IsChecked="{Binding UseSingleClassForSameFiles}" ToolTip="Single class generation allows to join similar files and query over them. Might not work well for files with relations">Generate single class for similar files</CheckBox>
            <CheckBox IsChecked="{Binding DetectRelations}" ToolTip="Detect relations between CSV files/tables (based on files and column names)">Detect relations</CheckBox>
            <CheckBox IsChecked="{Binding HideRelationsFromDump}" IsEnabled="{Binding DetectRelations}" ToolTip="LINQPad will not show relations content in .Dump(). This prevents from loading too many data" Margin="16,0,0,0">Hide relations from .Dump()</CheckBox>
            <CheckBox IsChecked="{Binding DebugInfo}" ToolTip="Show additional driver debug info">Debug info</CheckBox>
            <Separator/>
            <CheckBox IsChecked="{Binding Persist}" ToolTip="Persist connection">Remember this connection</CheckBox>
            <StackPanel Margin="0,8,0,0" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Name="OkButton" Content="OK" Margin="5,0,0,0" Padding="8,3" Width="85" IsDefault="True" Click="OkButton_Click" />
                <Button Content="Cancel" Margin="5,0,0,0" Padding="8,3" Width="85" IsCancel="True" />
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>
